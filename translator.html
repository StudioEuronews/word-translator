<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Multilingual Translator Word</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 300;
        }

        .content {
            padding: 30px;
        }

        .language-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }

        .language-option {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 8px;
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .language-option:hover {
            background-color: #f5f5f5;
        }

        .language-option input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        .language-option label {
            cursor: pointer;
            font-size: 0.9em;
            user-select: none;
        }

        .controls {
            margin-bottom: 25px;
        }

        .option-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .option-group h3 {
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #555;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.1);
        }

        .checkbox-option label {
            cursor: pointer;
            font-size: 0.9em;
        }

        .translate-btn {
            width: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .translate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .translate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-container {
            display: none;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .flag {
            margin-right: 5px;
            font-size: 1.1em;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Multilingual Translator</h1>
        </div>
        
        <div class="content">
            <div class="language-grid">
                <div class="language-option">
                    <input type="checkbox" id="fr" value="fr" checked>
                    <label for="fr">French</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="de" value="de" checked>
                    <label for="de">German</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="it" value="it" checked>
                    <label for="it">Italian</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="es" value="es" checked>
                    <label for="es">Spanish</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="pt" value="pt" checked>
                    <label for="pt">Portuguese</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="ru" value="ru" checked>
                    <label for="ru">Russian</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="el" value="el" checked>
                    <label for="el">Greek</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="hu" value="hu" checked>
                    <label for="hu">Hungarian</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="pl" value="pl" checked>
                    <label for="pl">Polish</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="fa" value="fa" checked>
                    <label for="fa">Farsi</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="ar" value="ar">
                    <label for="ar">Arabic</label>
                </div>
                <div class="language-option">
                    <input type="checkbox" id="tr" value="tr">
                    <label for="tr">Turkish</label>
                </div>
            </div>

            <div class="controls">
                <div class="option-group">
                    <h3>Translation Options</h3>
                    <div class="checkbox-option">
                        <input type="checkbox" id="preserveFormat" checked>
                        <label for="preserveFormat">Preserve layout</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="redText" checked>
                        <label for="redText">Translated text in red</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="newPage" checked>
                        <label for="newPage">New page per language</label>
                    </div>
                </div>
            </div>

            <button class="translate-btn" onclick="startTranslation()">
                üöÄ Start Translation
            </button>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText"></div>
            </div>

            <div class="status" id="status"></div>
        </div>
    </div>

    <script>
        // Languages with ISO 639-1 codes
        const languages = {
            'fr': { name: 'French' },
            'de': { name: 'German' },
            'it': { name: 'Italian' },
            'es': { name: 'Spanish' },
            'pt': { name: 'Portuguese' },
            'ru': { name: 'Russian' },
            'el': { name: 'Greek' },
            'hu': { name: 'Hungarian' },
            'pl': { name: 'Polish' },
            'fa': { name: 'Farsi' },
            'ar': { name: 'Arabic' },
            'tr': { name: 'Turkish' }
        };

        // Initialize Office
        Office.onReady((info) => {
            if (info.host === Office.HostType.Word) {
                console.log('Add-in loaded in Word');
            }
        });

        async function startTranslation() {
            const selectedLanguages = getSelectedLanguages();
            
            if (selectedLanguages.length === 0) {
                showStatus('Please select at least one language.', 'error');
                return;
            }

            const button = document.querySelector('.translate-btn');
            button.disabled = true;
            button.textContent = '‚è≥ Translation in progress...';

            showProgress(true);

            try {
                await Word.run(async (context) => {
                    // Get document content
                    const body = context.document.body;
                    body.load("text,style");
                    await context.sync();

                    const originalText = body.text;
                    
                    if (!originalText.trim()) {
                        throw new Error('The document is empty.');
                    }

                    // Translate for each selected language
                    for (let i = 0; i < selectedLanguages.length; i++) {
                        const langCode = selectedLanguages[i];
                        const langName = languages[langCode].name;
                        
                        updateProgress((i / selectedLanguages.length) * 100, `Translating to ${langName}...`);
                        
                        try {
                            const translatedText = await translateText(originalText, langCode);
                            await insertTranslation(context, translatedText, langName, langCode);
                        } catch (error) {
                            console.error(`Error translating to ${langName}:`, error);
                            await insertTranslation(context, `[Translation error for ${langName}]`, langName, langCode);
                        }
                    }

                    await context.sync();
                    updateProgress(100, 'Translation completed!');
                    
                    setTimeout(() => {
                        showProgress(false);
                        showStatus('Translation successful! The document has been updated.', 'success');
                    }, 1000);
                });

            } catch (error) {
                console.error('Error:', error);
                showStatus(`Error: ${error.message}`, 'error');
                showProgress(false);
            } finally {
                button.disabled = false;
                button.textContent = 'üöÄ Start Translation';
            }
        }

        async function insertTranslation(context, translatedText, langName, langCode) {
            const preserveFormat = document.getElementById('preserveFormat').checked;
            const redText = document.getElementById('redText').checked;
            const newPage = document.getElementById('newPage').checked;

            // Insert page break if requested
            if (newPage) {
                context.document.body.insertBreak(Word.BreakType.page, Word.InsertLocation.end);
            }

            // Insert language title
            const titleRange = context.document.body.insertText(`\n\n=== ${langName.toUpperCase()} ===\n\n`, Word.InsertLocation.end);
            titleRange.font.bold = true;
            titleRange.font.size = 16;
            titleRange.font.color = '#2196F3';

            // Insert translated text
            const textRange = context.document.body.insertText(translatedText, Word.InsertLocation.end);
            
            if (redText) {
                textRange.font.color = '#FF0000';
            }

            // Apply formatting if requested
            if (preserveFormat) {
                textRange.font.size = 12;
                // Skip paragraphFormat.spaceAfter as it's not always available in Word Online
            }

            await context.sync();
        }

        async function translateText(text, targetLang) {
            try {
                // Try Microsoft Translator first
                const response = await fetch(`https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=${targetLang}`, {
                    method: 'POST',
                    headers: {
                        'Ocp-Apim-Subscription-Key': 'YOUR_API_KEY_HERE',
                        'Ocp-Apim-Subscription-Region': 'YOUR_REGION_HERE',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify([{text: text}])
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result && result[0] && result[0].translations && result[0].translations[0]) {
                        return result[0].translations[0].text;
                    }
                }
            } catch (error) {
                console.log('Microsoft Translator not available, using fallback service');
            }
            
            try {
                // Fallback: MyMemory service
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${targetLang}`);
                const data = await response.json();
                
                if (data.responseData && data.responseData.translatedText) {
                    return data.responseData.translatedText;
                } else {
                    throw new Error('Translation service unavailable');
                }
            } catch (error) {
                // Last fallback: simulated text
                return `[${languages[targetLang].name} Translation] ${text}`;
            }
        }

        function getSelectedLanguages() {
            const checkboxes = document.querySelectorAll('.language-option input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function showProgress(show) {
            const container = document.getElementById('progressContainer');
            container.style.display = show ? 'block' : 'none';
        }

        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
